# truffle-ganache-test

[![npm](https://img.shields.io/npm/v/truffle-ganache-test.svg)](https://www.npmjs.com/package/truffle-ganache-test)

This [Truffle][truffle] plugin automatically starts a [ganache][ganache] instance runs `truffle test` and stops the instance afterwards. Ganache can be configured via the [truffle][truffle] config file.

## Installation

(1) Install the plugin and your desired [ganache-core][ganache] version with npm. For the latest version of ganche-core run
```sh
npm install truffle-contract-size ganache-core
```

Any version of [ganache-core][ganache] 2.x can be used.

(2) Add the plugin to your `truffle.js` or `truffle-config.js` file
```js
module.exports = {
  /* ... rest of truffle-config */

  plugins: [
    'truffle-ganache-test'
  ]
}
```

## Usage

The ganache instance is only started under the following conditions:

* The selected network is named `development` (default in truffle)
* The configured port for the development network is closed (no other process is using it right now)

The command can be executed without any arguments to run **all** tests in the projects.

```bash
truffle run ganache-test
```

To run only certain tests, one or more relative paths to test files can be given as arguments

```bash
truffle run ganache-test test/exampleTest1.js test/exampleTest2.js
```

## Ganache configuration

The plugin allows to configure the ganache instance via the configuration of the `development` network in `truffle.js` or `truffle-config.js`. All configuration options of [ganache-core][ganache] can be used.

Please see the following example:

```js
module.exports = {
  /* ... rest of truffle-config */

  networks: {
      development: {
          // configuration options used by truffle and the ganache instance
          host: 'localhost',
          port: 7545,
          network_id: '*',
          gas: 8000000,
          gasPrice: 0x01,

          // example configuration options specific for the ganache instance
          default_balance_ether: 1000000, // every account of ganache gets 1.000.000 Ether
          total_accounts: 100, // 100 acounts are generated by truffle
          hardfork: 'istanbul' // use istanbul hardfork
      }
  }
}
```

The configuration options used by truffle are used as well by the started ganache instance and don't have to be specified with the ganache specific options.

Please the [options section of ganache-core](https://github.com/trufflesuite/ganache-core#options) for the full list of available options.

[ganache]: https://github.com/trufflesuite/ganache-core
[truffle]: https://www.trufflesuite.com/docs/truffle/overview
