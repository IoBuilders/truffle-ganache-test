# truffle-ganache-test

[![npm](https://img.shields.io/npm/v/truffle-ganache-test.svg)](https://www.npmjs.com/package/truffle-ganache-test)

This [Truffle][truffle] plugin automatically starts a [ganache][ganache] instance runs `truffle test` and stops the instance afterwards. Ganache can be configured via the [truffle][truffle] config file to your specific needs.

## Installation

(1) Install the plugin and your desired [ganache-core][ganache] version with npm. For the latest version of ganche-core run
```sh
npm install truffle-contract-size ganache-core
```

Any version of [ganache-core][ganache] 2.x can be used.

(2) Add the plugin to your `truffle.js` or `truffle-config.js` file
```js
module.exports = {
    /* ... rest of truffle-config */

    plugins: [
        'truffle-ganache-test'
    ]
}
```

## Usage

The ganache instance is only started under the following conditions:

* The selected network is named `development` (default in truffle)
* The configured port for the development network is closed (no other process is using it at the moment)

The command can be executed without any arguments to run **all** tests in the projects.

```bash
truffle run ganache-test
```

To run only certain tests, one or more relative paths to test files can be given as arguments

```bash
truffle run ganache-test test/exampleTest1.js test/exampleTest2.js
```

## Configuration

The plugin can start the ganache instance out of the box with the required settings for a network in truffle.

Let's look at the following example of basic network config in `truffle.js` or `truffle-config.js`

```js
module.exports = {
    /* ... rest of truffle-config */

    networks: {
        development: {
            host: "127.0.0.1",
            port: 8545,
            network_id: "*"
        }
    }
}
```

With this config file, a ganache instance will be started which listens to `127.0.0.1:8545` and has a randomly generated network id. The tests will successfully be able to connect to it.

### Ganache specific settings

The plugin allows to configure the ganache instance to your specific needs via the configuration of the `development` network in `truffle.js` or `truffle-config.js`. Setting Ganache specific configurations in any other network will have no effect.

All configuration options of [ganache-core][ganache] can be used.

Please see the following example:

```js
module.exports = {
    /* ... rest of truffle-config */

    networks: {
        development: {
            /* ... rest of network config */
            
            default_balance_ether: 1000000, // every account of ganache gets 1.000.000 Ether
            total_accounts: 100, // 100 accounts are generated by truffle
            hardfork: 'istanbul' // use istanbul hardfork
        }
    }
}
```

Please the [options section of ganache-core](https://github.com/trufflesuite/ganache-core#options) for the full list of available options.

[ganache]: https://github.com/trufflesuite/ganache-core
[truffle]: https://www.trufflesuite.com/docs/truffle/overview
